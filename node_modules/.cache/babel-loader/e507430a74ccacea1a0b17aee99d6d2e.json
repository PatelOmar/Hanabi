{"ast":null,"code":"import firebase from 'firebase/app';\nimport 'firebase/firestore';\nimport 'firebase/auth';\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\nimport GameCodeGenerator from '../../tools/generator/GameCodeGenerator';\nimport CardShuffler from '../../tools/generator/CardShuffler';\nconst firebaseConfig = {\n  apiKey: \"AIzaSyBldhn6e08q69OTNq246uskucmmKfUZjvs\",\n  authDomain: \"hanabi-64915.firebaseapp.com\",\n  projectId: \"hanabi-64915\",\n  storageBucket: \"hanabi-64915.appspot.com\",\n  messagingSenderId: \"653806150744\",\n  appId: \"1:653806150744:web:eedc14e49aae6d1852962d\",\n  measurementId: \"G-C72H5J6WQ9\"\n};\nfirebase.initializeApp(firebaseConfig);\nexport const db = firebase.firestore();\nexport const auth = firebase.auth(); // const [user] = useAuthState(auth);\n\nexport const authSignIn = async () => {\n  const provider = new firebase.auth.GoogleAuthProvider();\n  auth.signInWithPopup(provider);\n};\nexport const createLobby = async () => {\n  // db.collection('lobby').add\n  let gameCodeExists = false;\n  let result;\n  let gameCode = null;\n  console.log(1);\n\n  while (!gameCodeExists) {\n    console.log(2);\n\n    try {\n      console.log(3);\n      gameCode = GameCodeGenerator();\n      result = await verifyGameCode(gameCode);\n      console.log(4);\n\n      if (!result) {\n        console.log(5);\n\n        try {\n          await db.collection('lobby').doc(gameCode).set({\n            host: auth.currentUser.uid,\n            playerCount: 1,\n            inSession: false,\n            playerList: [{\n              name: auth.currentUser.displayName,\n              id: auth.currentUser.uid\n            }],\n            timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n            code: gameCode\n          });\n          gameCodeExists = true;\n        } catch (err) {\n          console.log(err);\n        }\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  if (gameCode != null && gameCodeExists) {\n    return {\n      code: gameCode,\n      status: 200\n    };\n  } else if (gameCode === null) {\n    return {\n      code: null,\n      status: 500\n    };\n  } else {\n    return {\n      code: null,\n      status: 500\n    };\n  }\n};\nexport const startGame = async gameCode => {\n  db.collection('lobby').doc(gameCode).update({\n    inSession: true\n  });\n};\nexport const setUpGame = async () => {\n  // return\n  let setUpSuccessful = false;\n\n  try {\n    let shuffledDeck = CardShuffler();\n    console.log(shuffledDeck);\n    db.collection('lobby').doc(\"OBENQQ\").update({\n      shuffledCards: shuffledDeck,\n      hints: 8,\n      fuse: 4\n    });\n    setUpSuccessful = true;\n  } catch (err) {\n    console.log(err);\n  }\n\n  return setUpSuccessful;\n};\nexport const joinLobby = async gameCode => {\n  console.log(gameCode);\n  let result = await verifyGameCode(gameCode);\n\n  if (result) {\n    try {\n      db.collection('lobby').doc(gameCode).update({\n        playerCount: firebase.firestore.FieldValue.increment(1),\n        playerList: firebase.firestore.FieldValue.arrayUnion({\n          name: auth.currentUser.displayName,\n          id: auth.currentUser.uid\n        })\n      });\n      return {\n        code: gameCode,\n        status: 200\n      };\n    } catch (err) {\n      console.log(err);\n    }\n  } else {\n    console.log(\"Join DID NOT WORK\");\n    return {\n      code: null,\n      status: 500\n    };\n  }\n};\nexport const verifyGameCode = async code => {\n  return await db.collection('lobby').doc(code).get().then(querySnapshot => {\n    return querySnapshot.exists;\n  });\n}; // const verifyPlayer = async(code) => {\n//     return await db.collection('lobby').doc(code).get().then(function(doc) {\n//         if (doc.exists) {\n//             for (let player = 0; player < doc.data().playerList )\n//             return doc.data().playerList;\n//         } else {\n//             // doc.data() will be undefined in this case\n//             console.log(\"No such document!\");\n//         }\n//     })\n// }\n// const getPlayerCount = async(code) => {\n//     return await db.collection('lobby').doc(code).get().then(function(doc) {\n//         if (doc.exists) {\n//             return doc.data().playerCount;\n//         } else {\n//             // doc.data() will be undefined in this case\n//             console.log(\"No such document!\");\n//         }\n//     })\n// }","map":{"version":3,"sources":["/Users/omarp/workspace/React/Hanabi/src/services/firebase/firestore.js"],"names":["firebase","useAuthState","useCollectionData","GameCodeGenerator","CardShuffler","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","db","firestore","auth","authSignIn","provider","GoogleAuthProvider","signInWithPopup","createLobby","gameCodeExists","result","gameCode","console","log","verifyGameCode","collection","doc","set","host","currentUser","uid","playerCount","inSession","playerList","name","displayName","id","timestamp","FieldValue","serverTimestamp","code","err","status","startGame","update","setUpGame","setUpSuccessful","shuffledDeck","shuffledCards","hints","fuse","joinLobby","increment","arrayUnion","get","then","querySnapshot","exists"],"mappings":"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","sourcesContent":["import firebase from 'firebase/app';\nimport 'firebase/firestore';\nimport 'firebase/auth';\n\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\n\nimport GameCodeGenerator from '../../tools/generator/GameCodeGenerator';\nimport CardShuffler from '../../tools/generator/CardShuffler';\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBldhn6e08q69OTNq246uskucmmKfUZjvs\",\n    authDomain: \"hanabi-64915.firebaseapp.com\",\n    projectId: \"hanabi-64915\",\n    storageBucket: \"hanabi-64915.appspot.com\",\n    messagingSenderId: \"653806150744\",\n    appId: \"1:653806150744:web:eedc14e49aae6d1852962d\",\n    measurementId: \"G-C72H5J6WQ9\"\n};\n\nfirebase.initializeApp(firebaseConfig)\n\nexport const db = firebase.firestore();\nexport const auth = firebase.auth();\n// const [user] = useAuthState(auth);\n\nexport const authSignIn = async () => {\n    const provider = new firebase.auth.GoogleAuthProvider();\n    auth.signInWithPopup(provider);\n}\n\nexport const createLobby = async () => {\n    // db.collection('lobby').add\n    let gameCodeExists = false;\n    let result;\n    let gameCode = null;\n    console.log(1);\n\n    while (!gameCodeExists){\n        console.log(2);\n        try {\n            console.log(3);\n            gameCode = GameCodeGenerator();\n            result = await verifyGameCode(gameCode);\n            console.log(4);\n            if (!result){\n                console.log(5);\n                try{\n                    await db.collection('lobby').doc(gameCode).set({\n                        host: auth.currentUser.uid,\n                        playerCount: 1,\n                        inSession: false,\n                        playerList: [{name: auth.currentUser.displayName, id: auth.currentUser.uid}],\n                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n                        code: gameCode\n                    })    \n                    gameCodeExists = true;\n                } catch (err){\n                    console.log(err);\n                }\n            } \n        } catch(err) {\n            console.log(err);\n        }\n    }\n\n    if (gameCode != null && gameCodeExists){\n        return {code: gameCode, status: 200};\n    } else if (gameCode === null){\n        return {code: null, status: 500};\n    } else {\n        return {code: null, status: 500};\n    }\n\n}\nexport const startGame = async(gameCode) => {\n    db.collection('lobby').doc(gameCode).update({\n        inSession: true,\n    })    \n}\nexport const setUpGame = async() => {\n    // return\n    let setUpSuccessful = false;\n    try{\n        let shuffledDeck = CardShuffler();\n        console.log(shuffledDeck);\n        db.collection('lobby').doc(\"OBENQQ\").update({\n        shuffledCards: shuffledDeck,\n        hints: 8,\n        fuse: 4\n        });  \n        setUpSuccessful = true;\n    } catch(err){\n        console.log(err);\n    }\n    return setUpSuccessful;\n     \n}\nexport const joinLobby = async (gameCode) => {\n    console.log(gameCode)\n    let result = await verifyGameCode(gameCode);\n    if (result){\n        try{\n            db.collection('lobby').doc(gameCode).update({\n                playerCount: firebase.firestore.FieldValue.increment(1),\n                playerList: firebase.firestore.FieldValue.arrayUnion({name: auth.currentUser.displayName, id: auth.currentUser.uid})\n            });\n            return {code: gameCode, status: 200};\n        } catch (err){\n            console.log(err);\n        }\n    } else {\n        console.log(\"Join DID NOT WORK\")\n        return {code: null, status: 500};\n    }\n\n\n}\n\nexport const verifyGameCode = async(code) => {\n    return await db.collection('lobby').doc(code).get().then(querySnapshot => {return querySnapshot.exists;});\n}\n// const verifyPlayer = async(code) => {\n//     return await db.collection('lobby').doc(code).get().then(function(doc) {\n//         if (doc.exists) {\n//             for (let player = 0; player < doc.data().playerList )\n//             return doc.data().playerList;\n//         } else {\n//             // doc.data() will be undefined in this case\n//             console.log(\"No such document!\");\n//         }\n//     })\n// }\n// const getPlayerCount = async(code) => {\n//     return await db.collection('lobby').doc(code).get().then(function(doc) {\n//         if (doc.exists) {\n//             return doc.data().playerCount;\n//         } else {\n//             // doc.data() will be undefined in this case\n//             console.log(\"No such document!\");\n//         }\n//     })\n// }"]},"metadata":{},"sourceType":"module"}