{"ast":null,"code":"import firebase from 'firebase/app';\nimport 'firebase/firestore';\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\nimport GameCodeGenerator from '../../tools/generator/GameCodeGenerator';\nconst firebaseConfig = {\n  apiKey: \"AIzaSyBldhn6e08q69OTNq246uskucmmKfUZjvs\",\n  authDomain: \"hanabi-64915.firebaseapp.com\",\n  projectId: \"hanabi-64915\",\n  storageBucket: \"hanabi-64915.appspot.com\",\n  messagingSenderId: \"653806150744\",\n  appId: \"1:653806150744:web:eedc14e49aae6d1852962d\",\n  measurementId: \"G-C72H5J6WQ9\"\n};\nfirebase.initializeApp(firebaseConfig);\nexport const db = firebase.firestore();\nexport const createLobby = async host => {\n  // db.collection('lobby').add\n  let gameCodeExists = false;\n  let result;\n  let gameCode = null;\n\n  while (!gameCodeExists) {\n    try {\n      gameCode = GameCodeGenerator();\n      result = await verifyGameCode(gameCode);\n\n      if (!result) {\n        try {\n          db.collection('lobby').doc(gameCode).set({\n            host: host,\n            player2: null,\n            player3: null,\n            player4: null\n          });\n          gameCodeExists = true;\n        } catch (err) {}\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  if (gameCode != null && gameCodeExists) {\n    return {\n      code: gameCode,\n      status: 200\n    };\n  } else if (gameCode === null) {\n    return {\n      code: null,\n      status: 500\n    };\n  } else {\n    return {\n      code: null,\n      status: 500\n    };\n  }\n};\n\nconst verifyGameCode = async code => {\n  return await db.collection('lobby').doc(code).get().then(querySnapshot => {\n    return querySnapshot.exists;\n  });\n};","map":{"version":3,"sources":["/Users/omarp/workspace/React/Hanabi/src/services/firebase/firestore.js"],"names":["firebase","useCollectionData","GameCodeGenerator","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","initializeApp","db","firestore","createLobby","host","gameCodeExists","result","gameCode","verifyGameCode","collection","doc","set","player2","player3","player4","err","console","log","code","status","get","then","querySnapshot","exists"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,cAArB;AACA,OAAO,oBAAP;AAEA,SAASC,iBAAT,QAAkC,gCAAlC;AAEA,OAAOC,iBAAP,MAA8B,yCAA9B;AAEA,MAAMC,cAAc,GAAG;AACnBC,EAAAA,MAAM,EAAE,yCADW;AAEnBC,EAAAA,UAAU,EAAE,8BAFO;AAGnBC,EAAAA,SAAS,EAAE,cAHQ;AAInBC,EAAAA,aAAa,EAAE,0BAJI;AAKnBC,EAAAA,iBAAiB,EAAE,cALA;AAMnBC,EAAAA,KAAK,EAAE,2CANY;AAOnBC,EAAAA,aAAa,EAAE;AAPI,CAAvB;AAUAV,QAAQ,CAACW,aAAT,CAAuBR,cAAvB;AAEA,OAAO,MAAMS,EAAE,GAAGZ,QAAQ,CAACa,SAAT,EAAX;AAEP,OAAO,MAAMC,WAAW,GAAG,MAAOC,IAAP,IAAgB;AACvC;AACA,MAAIC,cAAc,GAAG,KAArB;AACA,MAAIC,MAAJ;AACA,MAAIC,QAAQ,GAAG,IAAf;;AACA,SAAO,CAACF,cAAR,EAAuB;AACnB,QAAI;AACAE,MAAAA,QAAQ,GAAGhB,iBAAiB,EAA5B;AACAe,MAAAA,MAAM,GAAG,MAAME,cAAc,CAACD,QAAD,CAA7B;;AACA,UAAI,CAACD,MAAL,EAAY;AACR,YAAG;AACCL,UAAAA,EAAE,CAACQ,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BH,QAA3B,EAAqCI,GAArC,CAAyC;AACrCP,YAAAA,IAAI,EAAEA,IAD+B;AAErCQ,YAAAA,OAAO,EAAE,IAF4B;AAGrCC,YAAAA,OAAO,EAAE,IAH4B;AAIrCC,YAAAA,OAAO,EAAE;AAJ4B,WAAzC;AAMAT,UAAAA,cAAc,GAAG,IAAjB;AACH,SARD,CAQE,OAAOU,GAAP,EAAW,CAEZ;AACJ;AACJ,KAhBD,CAgBE,OAAMA,GAAN,EAAW;AACTC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACH;AACJ;;AAED,MAAIR,QAAQ,IAAI,IAAZ,IAAoBF,cAAxB,EAAuC;AACnC,WAAO;AAACa,MAAAA,IAAI,EAAEX,QAAP;AAAiBY,MAAAA,MAAM,EAAE;AAAzB,KAAP;AACH,GAFD,MAEO,IAAIZ,QAAQ,KAAK,IAAjB,EAAsB;AACzB,WAAO;AAACW,MAAAA,IAAI,EAAE,IAAP;AAAaC,MAAAA,MAAM,EAAE;AAArB,KAAP;AACH,GAFM,MAEA;AACH,WAAO;AAACD,MAAAA,IAAI,EAAE,IAAP;AAAaC,MAAAA,MAAM,EAAE;AAArB,KAAP;AACH;AAEJ,CAnCM;;AAqCP,MAAMX,cAAc,GAAG,MAAMU,IAAN,IAAe;AAClC,SAAO,MAAMjB,EAAE,CAACQ,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BQ,IAA3B,EAAiCE,GAAjC,GAAuCC,IAAvC,CAA4CC,aAAa,IAAI;AAAC,WAAOA,aAAa,CAACC,MAArB;AAA6B,GAA3F,CAAb;AACH,CAFD","sourcesContent":["import firebase from 'firebase/app';\nimport 'firebase/firestore';\n\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\n\nimport GameCodeGenerator from '../../tools/generator/GameCodeGenerator';\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyBldhn6e08q69OTNq246uskucmmKfUZjvs\",\n    authDomain: \"hanabi-64915.firebaseapp.com\",\n    projectId: \"hanabi-64915\",\n    storageBucket: \"hanabi-64915.appspot.com\",\n    messagingSenderId: \"653806150744\",\n    appId: \"1:653806150744:web:eedc14e49aae6d1852962d\",\n    measurementId: \"G-C72H5J6WQ9\"\n};\n\nfirebase.initializeApp(firebaseConfig)\n\nexport const db = firebase.firestore();\n\nexport const createLobby = async (host) => {\n    // db.collection('lobby').add\n    let gameCodeExists = false;\n    let result;\n    let gameCode = null;\n    while (!gameCodeExists){\n        try {\n            gameCode = GameCodeGenerator();\n            result = await verifyGameCode(gameCode);\n            if (!result){\n                try{\n                    db.collection('lobby').doc(gameCode).set({\n                        host: host,\n                        player2: null,\n                        player3: null,\n                        player4: null\n                    })    \n                    gameCodeExists = true;\n                } catch (err){\n\n                }\n            } \n        } catch(err) {\n            console.log(err);\n        }\n    }\n    \n    if (gameCode != null && gameCodeExists){\n        return {code: gameCode, status: 200};\n    } else if (gameCode === null){\n        return {code: null, status: 500};\n    } else {\n        return {code: null, status: 500};\n    }\n\n}\n\nconst verifyGameCode = async(code) => {\n    return await db.collection('lobby').doc(code).get().then(querySnapshot => {return querySnapshot.exists;});\n}"]},"metadata":{},"sourceType":"module"}